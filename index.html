<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AR Respiratory Simulation</title>
  
    <!-- Load A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>

</head>
<body>
<h1>Please Confirm Camera access & Scan marker</h1>
<a-scene
  arjs
  embedded
  renderer="logarithmicDepthBuffer: true; "

  vr-mode-ui="enabled: false"
  id="scene"
>
  <a-assets>
    <a-asset-item
      id="resperatory-glb-model"
      src="./models/particles.glb"
      response-type="arraybuffer"
    >
    </a-asset-item>
  </a-assets>

      <a-marker rotatescale id="resperatory-glb-model-marker" type="pattern" url="./marker/pattern-lung_copilot_marker.patt">
      <a-entity
        id="resperatory-glb-model-child-entity"
        animation-mixer="loop: repeat; timeScale: 1"
        gltf-model="#resperatory-glb-model"
        scale="0.25 0.25 0.25"
      position="0 0 0"
      rotation="-90 0 0">

    </a-entity>
  </a-marker>

  <a-entity camera></a-entity>
        <a-entity
      light="type: point; intensity: 2; decay: 2"
      position="0 0 0">
    </a-entity>
</a-scene>

<script>
AFRAME.registerComponent("rotatescale", {
    init: function() {
        let element = document.querySelector('body');
        let hammerEl = new Hammer(element);

        this.marker = document.querySelector('a-marker'); // Component rotatescale needs to be applied on the a-marker tag
        let model = this.marker.querySelector('#resperatory-glb-model-child-entity');

        let pinch = new Hammer.Pinch(); // Pinch is not by default in the recognizers
         hammerEl.add(pinch); // Add it to the Manager instance

        let rotate = new Hammer.Rotate();
        hammeerEl.add(rotate)
       

             
             let initialScale = { x: 1, y: 1, z: 1 }; // default
        hammerEl.on("pinchstart", () => {
            // Store the current scale when pinch starts
            const currentScale = model.getAttribute("scale");
            initialScale = { ...currentScale };
        });
        hammerEl.get('pan').set({ direction: Hammer.DIRECTION_ALL });
        //2 - left, 4 - right, 8 - up, 16 - down
        hammerEl.on('pan', (ev) => {
            let rotation = model.getAttribute("rotation");
            switch(ev.direction) {
       case 2:
         rotation.y = rotation.y + 4
         break;
       case 4:
         rotation.y = rotation.y - 4
         break;
       case 8:
         rotation.x = rotation.x + 4
         break;
       case 16:
         rotation.x = rotation.x - 4
         break;
       default:
         break;
     }
            model.setAttribute("rotation", rotation);
        });

   hammerEl.on("pinch", (ev) => {
            // Apply scale relative to initial scale
            let newScale = {
                x: initialScale.x * ev.scale,
                y: initialScale.y * ev.scale,
                z: initialScale.z * ev.scale,
            };
            model.setAttribute("scale", newScale);
        });
    }
});
</script>

</body>
</html>
